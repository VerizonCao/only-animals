{"ast":null,"code":"var _jsxFileName = \"/Users/caoye/git/onlyfan-app/frontend/myfrontend/src/components/ChatPage.js\",\n  _s = $RefreshSig$();\nimport { useState } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport './ChatPage.css';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction ChatPage() {\n  _s();\n  const {\n    animal\n  } = useParams();\n  const [message, setMessage] = useState('');\n  const [chatHistory, setChatHistory] = useState([]);\n\n  // Helper function to get CSRF token from cookies\n  function getCSRFToken() {\n    const cookies = document.cookie.split(';');\n    for (let cookie of cookies) {\n      const [name, value] = cookie.trim().split('=');\n      if (name === 'csrftoken') {\n        return value;\n      }\n    }\n    return null;\n  }\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (message.trim()) {\n      const newMessage = {\n        text: message,\n        sender: 'user',\n        timestamp: new Date().toLocaleTimeString()\n      };\n\n      // Add user message to chat history\n      setChatHistory([...chatHistory, newMessage]);\n      try {\n        // Get CSRF token\n        const csrfToken = getCSRFToken();\n        if (!csrfToken) {\n          throw new Error('CSRF token not found in cookies. Please check your backend setup.');\n        }\n\n        // Make API request using axios\n        const {\n          data\n        } = await axios.post('http://localhost:8000/chat/chat/', {\n          animal,\n          message\n        }, {\n          headers: {\n            'X-CSRFToken': csrfToken // Include the CSRF token\n          },\n          withCredentials: true // Ensure cookies are sent with the request\n        });\n\n        // Add animal's response to chat history\n        setChatHistory(prev => [...prev, {\n          text: data.response,\n          sender: 'animal',\n          timestamp: new Date().toLocaleTimeString()\n        }]);\n      } catch (error) {\n        console.error('Error getting response:', error);\n\n        // Add error message to chat history\n        setChatHistory(prev => [...prev, {\n          text: \"Sorry, I couldn't get a response at the moment.\",\n          sender: 'animal',\n          timestamp: new Date().toLocaleTimeString()\n        }]);\n      }\n\n      // Clear input message\n      setMessage('');\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-header\",\n      children: [/*#__PURE__*/_jsxDEV(Link, {\n        to: \"/\",\n        className: \"back-button\",\n        children: \"\\u2190 Back\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: [\"Chat with \", animal]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-history\",\n      children: chatHistory.map((msg, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `message ${msg.sender}`,\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: msg.text\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"timestamp\",\n          children: msg.timestamp\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 13\n        }, this)]\n      }, index, true, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      className: \"chat-input\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        value: message,\n        onChange: e => setMessage(e.target.value),\n        placeholder: \"Type your message...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        children: \"Send\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatPage, \"dgO/UanmL8xjUK4b6IrxsCvzcuc=\", false, function () {\n  return [useParams];\n});\n_c = ChatPage;\nexport default ChatPage;\nvar _c;\n$RefreshReg$(_c, \"ChatPage\");","map":{"version":3,"names":["useState","useParams","Link","axios","jsxDEV","_jsxDEV","ChatPage","_s","animal","message","setMessage","chatHistory","setChatHistory","getCSRFToken","cookies","document","cookie","split","name","value","trim","handleSubmit","e","preventDefault","newMessage","text","sender","timestamp","Date","toLocaleTimeString","csrfToken","Error","data","post","headers","withCredentials","prev","response","error","console","className","children","to","fileName","_jsxFileName","lineNumber","columnNumber","map","msg","index","onSubmit","type","onChange","target","placeholder","_c","$RefreshReg$"],"sources":["/Users/caoye/git/onlyfan-app/frontend/myfrontend/src/components/ChatPage.js"],"sourcesContent":["import { useState } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport './ChatPage.css';\nimport axios from 'axios';\n\nfunction ChatPage() {\n  const { animal } = useParams();\n  const [message, setMessage] = useState('');\n  const [chatHistory, setChatHistory] = useState([]);\n\n  // Helper function to get CSRF token from cookies\n  function getCSRFToken() {\n    const cookies = document.cookie.split(';');\n    for (let cookie of cookies) {\n      const [name, value] = cookie.trim().split('=');\n      if (name === 'csrftoken') {\n        return value;\n      }\n    }\n    return null;\n  }\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (message.trim()) {\n      const newMessage = {\n        text: message,\n        sender: 'user',\n        timestamp: new Date().toLocaleTimeString(),\n      };\n\n      // Add user message to chat history\n      setChatHistory([...chatHistory, newMessage]);\n\n      try {\n        // Get CSRF token\n        const csrfToken = getCSRFToken();\n        if (!csrfToken) {\n          throw new Error('CSRF token not found in cookies. Please check your backend setup.');\n        }\n\n        // Make API request using axios\n        const { data } = await axios.post(\n          'http://localhost:8000/chat/chat/',\n          { animal, message },\n          {\n            headers: {\n              'X-CSRFToken': csrfToken, // Include the CSRF token\n            },\n            withCredentials: true, // Ensure cookies are sent with the request\n          }\n        );\n\n        // Add animal's response to chat history\n        setChatHistory((prev) => [\n          ...prev,\n          {\n            text: data.response,\n            sender: 'animal',\n            timestamp: new Date().toLocaleTimeString(),\n          },\n        ]);\n      } catch (error) {\n        console.error('Error getting response:', error);\n\n        // Add error message to chat history\n        setChatHistory((prev) => [\n          ...prev,\n          {\n            text: \"Sorry, I couldn't get a response at the moment.\",\n            sender: 'animal',\n            timestamp: new Date().toLocaleTimeString(),\n          },\n        ]);\n      }\n\n      // Clear input message\n      setMessage('');\n    }\n  };\n\n  return (\n    <div className=\"chat-container\">\n      <div className=\"chat-header\">\n        <Link to=\"/\" className=\"back-button\">‚Üê Back</Link>\n        <h2>Chat with {animal}</h2>\n      </div>\n\n      <div className=\"chat-history\">\n        {chatHistory.map((msg, index) => (\n          <div key={index} className={`message ${msg.sender}`}>\n            <p>{msg.text}</p>\n            <span className=\"timestamp\">{msg.timestamp}</span>\n          </div>\n        ))}\n      </div>\n\n      <form onSubmit={handleSubmit} className=\"chat-input\">\n        <input\n          type=\"text\"\n          value={message}\n          onChange={(e) => setMessage(e.target.value)}\n          placeholder=\"Type your message...\"\n        />\n        <button type=\"submit\">Send</button>\n      </form>\n    </div>\n  );\n}\n\nexport default ChatPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}